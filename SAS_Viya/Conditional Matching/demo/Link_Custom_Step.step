{"creationTimeStamp":"2024-09-23T16:07:18.053Z","modifiedTimeStamp":"2024-09-26T13:56:33.102Z","createdBy":"viyademo01","modifiedBy":"viyademo01","name":"Link Custom Step.step","displayName":"Link Custom Step.step","localDisplayName":"Link Custom Step.step","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","uri":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","uri":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","uri":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","uri":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e/copy","uri":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","uri":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","uri":"/dataFlows/steps/f053c3fe-2474-4328-8730-1a70a0a00e9e","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"page1\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Page 1\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"text1\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"The step re-links custom steps in a Studio Flow job. \\n* Select a Studio Flow\\n* Set the step name to be re-linked\\n* Select the Custom Step file to be used for the new link\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_dataFlow\",\n\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\"label\": \"Studio Flow:\",\n\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\"placeholder\": \"Select flow to re-link custom steps\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section1\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Custom Step\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_additionalStep1\",\n\t\t\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\t\t\"label\": \"Link additional custom step\",\n\t\t\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\t\t1,\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepOld1\",\n\t\t\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\t\t\"label\": \"Studio Flow Custom Step.\",\n\t\t\t\t\t\t\t\"placeholder\": \"Set name of Custom Step in the flow to be re-linked\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepNew1\",\n\t\t\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\t\t\"label\": \"New Custom Step:\",\n\t\t\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\t\t\"placeholder\": \"Select Custom Step file for re-link\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section2\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Additional Custom Step\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$_customStepOld1\",\n\t\t\t\t\t\t\"!=\",\n\t\t\t\t\t\t\"\"\n\t\t\t\t\t],\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_additionalStep2\",\n\t\t\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\t\t\"label\": \"Link additional custom step\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepOld2\",\n\t\t\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\t\t\"label\": \"Studio Flow Custom Step.\",\n\t\t\t\t\t\t\t\"placeholder\": \"Set name of Custom Step in the flow to be re-linked\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep2\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepNew2\",\n\t\t\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\t\t\"label\": \"New Custom Step:\",\n\t\t\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\t\t\"placeholder\": \"Select Custom Step file for re-link\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep2\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section3\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Additional Custom Step\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$_customStepOld2\",\n\t\t\t\t\t\t\"!=\",\n\t\t\t\t\t\t\"\"\n\t\t\t\t\t],\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_additionalStep3\",\n\t\t\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\t\t\"label\": \"Link additional custom step\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepOld3\",\n\t\t\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\t\t\"label\": \"Studio Flow Custom Step.\",\n\t\t\t\t\t\t\t\"placeholder\": \"Set name of Custom Step in the flow to be re-linked\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep3\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepNew3\",\n\t\t\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\t\t\"label\": \"New Custom Step:\",\n\t\t\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\t\t\"placeholder\": \"Select Custom Step file for re-link\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep3\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section4\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Additional Custom Step\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$_customStepOld3\",\n\t\t\t\t\t\t\"!=\",\n\t\t\t\t\t\t\"\"\n\t\t\t\t\t],\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_additionalStep4\",\n\t\t\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\t\t\"label\": \"Link additional custom step\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepOld4\",\n\t\t\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\t\t\"label\": \"Studio Flow Custom Step.\",\n\t\t\t\t\t\t\t\"placeholder\": \"Set name of Custom Step in the flow to be re-linked\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep4\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepNew4\",\n\t\t\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\t\t\"label\": \"New Custom Step:\",\n\t\t\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\t\t\"placeholder\": \"Select Custom Step file for re-link\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep4\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"section5\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Additional Custom Step\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": [\n\t\t\t\t\t\t\"$_customStepOld4\",\n\t\t\t\t\t\t\"!=\",\n\t\t\t\t\t\t\"\"\n\t\t\t\t\t],\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_additionalStep5\",\n\t\t\t\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\t\t\t\"label\": \"Link additional custom step\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepOld5\",\n\t\t\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\t\t\"label\": \"Studio Flow Custom Step.\",\n\t\t\t\t\t\t\t\"placeholder\": \"Set name of Custom Step in the flow to be re-linked\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep5\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_customStepNew5\",\n\t\t\t\t\t\t\t\"type\": \"path\",\n\t\t\t\t\t\t\t\"label\": \"New Custom Step:\",\n\t\t\t\t\t\t\t\"pathtype\": \"file\",\n\t\t\t\t\t\t\t\"placeholder\": \"Select Custom Step file for re-link\",\n\t\t\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\t\t\"enabled\": [\n\t\t\t\t\t\t\t\t\"$_additionalStep5\",\n\t\t\t\t\t\t\t\t\"=\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"_dataFlow\": \"\",\n\t\t\"_additionalStep1\": true,\n\t\t\"_customStepOld1\": \"\",\n\t\t\"_customStepNew1\": \"\",\n\t\t\"_additionalStep2\": false,\n\t\t\"_customStepOld2\": \"\",\n\t\t\"_customStepNew2\": \"\",\n\t\t\"_customStepOld3\": \"\",\n\t\t\"_customStepNew3\": \"\",\n\t\t\"_customStepOld4\": \"\",\n\t\t\"_customStepNew4\": \"\",\n\t\t\"_customStepOld5\": \"\",\n\t\t\"_customStepNew5\": \"\"\n\t}\n}","templates":{"SAS":"/***************************************************************************\n* Custom Step: Link Custom Step\n* --------------------------------------------------------------------------\n* This custom step can be used to link a custom step back with its step \n* information if the link to the step info is broken.\n* The link to a custom step in a studio flow can break if you import the \n* .flw and .step files directly into studio.\n* --------------------------------------------------------------------------\n* Note: Macros starting with an underscore contain UI variable values\n****************************************************************************/\n/* ----------------------------------------------------------------------- */\n/* Check if the studio file is on sascontent and if it is a flow file      */ \n/* ----------------------------------------------------------------------- */\n%macro checkIfFlow();\n\t%global dataFlow;\n\t%if &_dataFlow ~= %then %do;\n\t\t%let dataFlow= %substr(&_dataFlow, 12);\n\t\t%let folderserver= %substr(&_dataFlow, 1, 10);\n\t\tdata _null_;\n\t\t\tfile print;\t\n\t\t\tfolderserver= \"&folderserver\";\n\t\t\tif folderserver ~= \"sascontent\" then do;\n\t\t\t\tput \"ERROR: Wrong input folder!\";\n\t\t\t\tput \"The Studio Flow file needs to be on sascontent!\";\n\t\t\t\terror \"ERROR: Wrong input folder! The Studio Flow file needs to be on sascontent!\";\n\t\t\t\tabort;\n\t\t\tend;\n\t\trun;\n\t%end;\n\t%if &_dataFlow ~= and %substr(&_dataFlow, %length(&_dataFlow)-2) ~= flw %then %do;\n\t\tdata _null_;\n\t\t\tfile print;\t\n\t\t\tput \"ERROR: Wrong input file!\";\n\t\t\tput \"Please select a SAS Studio Flow file.\";\n\t\t\terror \"ERROR: Wrong input file! Please select a SAS Studio Flow file.\";\n\t\t\tabort;\n\t\trun;\n\t%end;\n%mend checkIfFlow;\n\n\n/* ----------------------------------------------------------------------- */\n/* Check if the step file is on sascontent and if it is a step file        */ \n/* ----------------------------------------------------------------------- */\n%macro checkIfCustomStep(_customStepNew, cnt);\n\t%global customStepNew;\n\t%if &_customStepNew ~= %then %do;\n\t\t%let customStepNew= %substr(&_customStepNew, 12);\n\t\t%let folderserver= %substr(&_customStepNew, 1, 10);\n\t\tdata _null_;\n\t\t\tfile print;\t\n\t\t\tfolderserver= \"&folderserver\";\n\t\t\tif folderserver ~= \"sascontent\" then do;\n\t\t\t\tput \"Custom Step &cnt\";\n\t\t\t\tput \"ERROR: Wrong input folder!\";\n\t\t\t\tput \"The Custom Step file needs to be on sascontent!\";\n\t\t\t\terror \"ERROR: Custom Step &cnt. Wrong input folder! The Custom Step file needs to be on sascontent!\";\n\t\t\t\tabort;\n\t\t\tend;\n\t\trun;\n\t%end;\n\t%if &_customStepNew ~= and %substr(&_customStepNew, %length(&_customStepNew)-3) ~= step %then %do;\n\t\tdata _null_;\n\t\t\tfile print;\t\n\t\t\tput \"Custom Step &cnt\";\n\t\t\tput \"ERROR: Wrong input file!\";\n\t\t\tput \"Please select a Custom Step file.\";\n\t\t\terror \"ERROR: Custom Step &cnt. Wrong input file! Please select a Custom Step file.\";\n\t\t\tabort;\n\t\trun;\n\t%end;\n%mend checkIfCustomStep;\n\n/* ----------------------------------------------------------------------- */\n/* Run Python script to:                                                   */\n/* - get the flow URL                                                      */\n/* - get the step URL                                                      */\n/* - set the step URL for all steps with name of replacement step          */\n/* - update the Studio Flow                                                */\n/* ----------------------------------------------------------------------- */\n%macro linkCustomStep();\n\tfilename PYCODE TEMP;\n\tdata _null_;\n\t\tfile PYCODE;\n\t\tput \"import json\";\n\t\tput \"###############################################################################\";\n        put \"def relinkStep(nodes):\";\n\t\tput \"    for nodeId in nodes:\";\n\t\tput \"        if nodes[nodeId]['name'].strip() == replaceStep and nodes[nodeId]['nodeType'] == 'step':\";\n\t    put \"            print(f'Changing Custom Step >{nodes[nodeId][\"\"name\"\"]}< from URL >{nodes[nodeId][\"\"stepReference\"\"][\"\"path\"\"]}< to URL >{stepURL}<')\";\n\t\tput \"            nodes[nodeId]['stepReference']['path']= stepURL\";\n\t\tput \"            nodes[nodeId]['properties']['UI_PROP_NODE_DATA_ID']= stepId\";\n\t\tput \"            SAS.symput('errorMsg_','')\";\n\t\tput \"###############################################################################\";\n\t\tput \"def getETag(hdinfoFile):\";\n\t\tput \"\ttag= 'ETag'\";\n\t\tput \"\tvalue= ''\";\n\t\tput \"\t#read the header info file\";\n\t\tput \"\twith open(hdinfoFile, 'r') as header:\";\n\t\tput \"\t    lines= header.readlines()\";\n\t\tput \"\t\";\n\t\tput \"\t#go through the file and find the tag.\";\n\t\tput \"\tfor line in lines:\";\n\t\tput \"\t    line= line.strip()\";\n\t\tput \"\t    if tag.lower() == line[0:len(tag)].lower():\";\n\t\tput \"\t        value= line[len(tag)+1:].strip()\";\n\t\tput \"\tprint(\"\"Etag----> \"\" +value)\";\n\t\tput \"\treturn value\";\n\t\tput \" \";\n\t\tput \"###############################################################################\";\n\t\tput \"def execHTTP(method, baseurl, url, httpoutFile, hdinfoFile, payloadFile='', eTag= ''):\";\n\t\tput \" \";\n\t\tput \"\tinBody= ''\";\n\t\tput \"\tpayload= ''\";\n\t\tput \"\tif method.upper() == 'PUT':\";\n\t\tput \"\t\tpayload= f\"\"filename payload '{payloadFile}';\"\"\";\n\t\tput \"\t\tinBody= \"\"in= payload\"\"\";\n\t\tput \"\t\teTag= f\"\"'if-match'= '{eTag}'\"\"\";\n\t\tput \" \";\n\t\tput \"\t# Proc HTTP calling the URL\";\n\t\tput \"\tsasCode= f\"\"\"\"\"\"\";\n\t\tput \"\tfilename httpout '{httpoutFile}';\";\n\t\tput \"\tfilename hdinfo '{hdinfoFile}';\";\n\t\tput \"\t{payload}\";\n\t\tput \" \";\n\t\tput \"\tproc http\";\n\t\tput \"\t\tmethod= \"\"{method}\"\"   \t\";\n\t\tput \"\t\turl= '{baseurl}{url}'\";\n\t\tput \"\t\t{inBody}\";\n\t\tput \"\t\tout= httpout\";\n\t\tput \"\t\theaderout= hdinfo\";\n\t\tput \"\t    oauth_bearer= sas_services\";\n\t\tput \"\t\ttimeout= 30;\";\n\t\tput \"\t \theaders \";\n\t\tput \"\t    \t\"\"Content-Type\"\"=\"\"application/json\"\"\";\n\t\tput \"\t\t\t{eTag}\";\n\t\tput \"\t\t\t;\";\n\t\tput \"\trun;\";\n\t\tput \"\t\"\"\"\"\"\"\";\n\t\tput \"\tSAS.submit(sasCode)\";\n\t\tput \"###############################################################################\";\n\t\tput \" \";\n\t\tput \"def getFileURL(baseurl, url, httpoutFile, hdinfoFile, fileName):\";\n\t\tput \"\t# get the url for the folder where the file resides\";\n\t\tput \"\texecHTTP('GET', baseurl, url, httpoutFile, hdinfoFile)\";\n\t\tput \"\t\";\n\t\tput \"\t# get the list of all folder members\";\n\t\tput \"\twith open(httpoutFile, 'r') as httpoutJson:\";\n\t\tput \"\t\thttpout= json.load(httpoutJson)\";\n\t\tput \"\tfor link in httpout['links']:\";\n\t\tput \"\t    if link['rel'] == 'members':\";\n\t\tput \"\t        url= link['uri']\";\n\t\tput \"\texecHTTP('GET', baseurl, url, httpoutFile, hdinfoFile)\";\n\t\tput \"\t\";\n\t\tput \"\tfolderUrl= ''\";\n\t\tput \"\t# lookup the file URL and get the file information\";\n\t\tput \"\twith open(httpoutFile, 'r') as httpoutJson:\";\n\t\tput \"\t\thttpout= json.load(httpoutJson)\";\n\t\tput \"\tfor member in httpout['items']:\";\n\t\tput \"\t    if member['name'] == fileName:\";\n\t\tput \"\t        folderUrl= member['uri']\";\n\t\tput \"\treturn folderUrl\";\n\t\tput \"###############################################################################\";\n\t\tput \"httpoutFile= '/tmp/~httpout.json'\";\n\t\tput \"hdinfoFile=  '/tmp/~headerout.txt'\";\n\t\tput \"payloadFile=  '/tmp/~payload.json'\";\n\t\tput \" \";\n\t\tput \"# get the Viya URL\";\n\t\tput \"baseurl= SAS.symget('_baseurl')\";\n\t\tput \"baseurl= baseurl[0:baseurl.find('/SASStudio')]\";\n\t\tput \" \";\n\t\tput \"# split into path and file name\";\n\t\tput \"flowFolder= SAS.symget('dataFlow')\";\n\t\tput \"flowPath= flowFolder[0:flowFolder.rfind('/')]\";\n\t\tput \"flowName= flowFolder[flowFolder.rfind('/')+1:]\";\n\t\tput \"print('flowPath=' +flowPath) \";\n\t\tput \"print('flowName=' +flowName) \";\n\t\tput \"SAS.symput('flowName_', flowName)\";\n\t\tput \" \";\n\t\tput \"#get the flow URL\";\n\t\tput \"url= f\"\"/folders/folders/@item?path={flowPath}\"\"\";\n\t\tput \"flowURL= getFileURL(baseurl, url, httpoutFile, hdinfoFile, flowName)\";\n\t\tput \"print('flowURL=' +flowURL)\";\n\t\tput \" \";\n\t\tput \"# split into path and file name\";\n\t\tput \"stepFolder= SAS.symget('customStepNew')\";\n\t\tput \"stepPath= stepFolder[0:stepFolder.rfind('/')]\";\n\t\tput \"stepName= stepFolder[stepFolder.rfind('/')+1:]\";\n\t\tput \"print('stepPath=' +stepPath)\";\n\t\tput \"print('stepName=' +stepName)\";\n\t\tput \" \";\n\t\tput \"# get the step URL\";\n\t\tput \"url= f\"\"/folders/folders/@item?path={stepPath}\"\"\";\n\t\tput \"stepURL= getFileURL(baseurl, url, httpoutFile, hdinfoFile, stepName)\";\n\t\tput \"stepId= stepURL[stepURL.rfind('/')+1:] \";\n\t\tput \"print('stepURL=' +stepURL)\";\n\t\tput \"print('stepId=' +stepId)\";\n\t\tput \" \";\n\t\tput \"replaceStep= SAS.symget('customStepOld').strip()\";\n\t\tput \"#read the flow information\";\n\t\tput \"execHTTP('GET', baseurl, flowURL, httpoutFile, hdinfoFile)\";\n\t\tput \"eTag= getETag(hdinfoFile)\";\n\t\tput \"with open(httpoutFile, 'r') as httpoutJson:\";\n\t\tput \"\tflowJob= json.load(httpoutJson)\";\n\t\tput \"#change the custom step link in the flow\";\n\t\tput \"print(f'Re-link Step: {replaceStep}')\";\n\t\tput \"SAS.symput('errorMsg_', f\"\"Could not find Custom Step >{replaceStep}<\"\")\";\n\t\tput \"callOnlyOnce = True\";\n\t\tput \"for nodeId in flowJob['nodes']:\";\n\t\tput \"    if flowJob['nodes'][nodeId]['nodeType'] == 'dataFlow':\";\n\t\tput \"        nodes= flowJob['nodes'][nodeId]['dataFlowAndBindings']['dataFlow']['nodes']\";\n\t\tput \"        relinkStep(nodes)\";\n\t\tput \"    else:\";\n\t\tput \"        if callOnlyOnce == True:\";\n\t\tput \"            nodes= flowJob['nodes']\";\n\t\tput \"            relinkStep(nodes)\";\n\t\tput \"            callOnlyOnce= False\";\n\t\tput \" \";\n\t\tput \"#need to write the payload to a file as SAS cannot handle big payload in a string!\";\n\t\tput \"with open(payloadFile, 'w') as f:\";\n\t\tput \"\tjson.dump(flowJob, f)\";\n\t\tput \"#update flow with changed custom step id\";\n\t\tput \"execHTTP('PUT', baseurl, flowURL, httpoutFile, hdinfoFile, payloadFile, eTag)\";\n\trun;\n\t\n\tproc python infile= PYCODE; quit;\n\n\t%global errorMsg flowName;\n\t%let errorMsg= %nrquote(&errorMsg_);\n\t%let flowName= %nrquote(&flowName_);\n%mend linkCustomStep;\n\n\n/* ----------------------------------------------------------------------- */\n/* main                                                                    */\n/* ----------------------------------------------------------------------- */\n%macro main();\n\t%global customStepOld;\n\t%checkIfFlow();\n\t%let headlinemsg= 0;\n\n\t%do i=1 %to 2;\n\t\t%if &&_customStepOld&i ~= and &&_customStepNew&i ~= and &&_additionalStep&i = 1 %then %do;\n\t\t\t%checkIfCustomStep(&&_customStepNew&i, &i);\n\t\t\t%let customStepOld= &&_customStepOld&i;\n\t\t\t%linkCustomStep();\n\t\t\t%if &headlinemsg = 0 %then %do;\n\t\t\t\tdata _null_;\n\t\t\t\t\tfile print;\t\n\t\t\t\t\tput \"SAS Studio Flow >&flowName<\";\n\t\t\t\trun;\n\t\t\t\t%let headlinemsg= 1;\n\t\t\t%end;\n\n\t\t\t%if &errorMsg ~= %then %do;\n\t\t\t\tdata _null_;\n\t\t\t\t\tfile print;\t\n\t\t\t\t\tput \"Custom Step &i\";\n\t\t\t\t\tput \"WARNING: &errorMsg\";\n\t\t\t\t\terror \"WARNING: Custom Step &i. &errorMsg\";\n\t\t\t\trun;\n\t\t\t%end;\n\t\t\t%else %do;\n\t\t\t\tdata _null_;\n\t\t\t\t\tfile print;\t\n\t\t\t\t\tcustomStepOld= strip(\"&customStepOld\");\n\t\t\t\t\tmsg= cats(\"Successfully re-linked Step: >\", customStepOld, \"<\");\n\t\t\t\t\tput \"Custom Step &i\";\n\t\t\t\t\tput msg;\n\t\t\t\trun;\n\t\t\t%end;\n\t\t%end;\n\t%end;\n\n%mend main;\n\n%main();\n\n\n/* +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ */\n/* CLEAN UP                                                                */\n/* +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ */\n/* ----------------------------------------------------------------------- */\n/* clean up macros variables used in this step                             */\n/* ----------------------------------------------------------------------- */\n%if %symexist(dataFlow) %then %do;\n\t%symdel dataFlow;\n%end;\n%if %symexist(customStepNew) %then %do;\n\t%symdel customStepNew;\n%end;\n%if %symexist(customStepOld) %then %do;\n\t%symdel customStepOld;\n%end;\n%if %symexist(errorMsg) %then %do;\n\t%symdel errorMsg;\n%end;\n%if %symexist(flowName) %then %do;\n\t%symdel flowName;\n%end;\n\n/* ----------------------------------------------------------------------- */\n/* clean up macros used in this step                                       */\n/* ----------------------------------------------------------------------- */\n%sysmacdelete main;\n%sysmacdelete checkIfFlow;\n%sysmacdelete checkIfCustomStep;\n%sysmacdelete linkCustomStep;\n"}}